---
id: react-with-elements
title: Integrate autentication into React
sidebar_label: React With Elements
---

```mdx-code-block
import Teaser from '../_common/teaser.mdx'
import mp4 from '../_static/react/screencast.mp4'
import webm from '../_static/react/screencast.webm'

<Teaser
  framework={<a href="https://reactjs.org/">React</a>}
  mp4={mp4}
  webm={webm}
/>
```

## Requirements

- Create Ory Console Account/Project
- Install Ory CLI
- Install Node.js LTS

### Create Project with Vite

First we create a React TypeScript SPA with Vite:

```bash
npm create vite@latest react-ts -- --template react-ts
cd react-ts
npm i
npm run dev
```

### Install Dependencies

If you don't already have the latest Node.js LTS, install it from here [Node.js LTS](https://nodejs.org/en/download/)

To interact with Ory's APIs we install the [Ory SDK](https://www.npmjs.com/package/@ory/client)

To use the Ory Element features, we install [Ory Elements](https://www.npmjs.com/package/@ory/elements)

To manage our routes more dynamically, we install [React Router](https://www.npmjs.com/package/react-router-dom)

```bash
npm i @ory/client @ory/elements react-router-dom --save
```

To install Ory CLI follow [this guide](https://www.ory.sh/docs/guides/ory-cli-install-use)

### Why do I Need the Ory CLI?

```mdx-code-block
import OryCLI from '../_common/ory-cli.mdx'

<OryCLI />
```

```mdx-code-block
import SdkEnvVar from '@site/src/components/SdkEnvVar'

<SdkEnvVar />
```

### Create .env

If you'd prefer to store your credentials in a .env file, you can do so by creating a .env file in the root of your project and
adding the following:

```bash
VITE_ORY_SDK_URL=http://localhost:4000
```

### package.json

At this point, your package.json should look something like this:

```json
...
{
  "dependencies": {
    "@ory/client": "^0.2.0-alpha.48",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.4.2"
  }
}
...
```

### Create sdk.ts

This file is used to create a new instance of the Ory SDK. We will use this instance to interact with the Ory APIs.

```typescript
import { V0alpha2Api, Configuration } from "@ory/client"

export default new V0alpha2Api(
  new Configuration({
    //https://vitejs.dev/guide/env-and-mode.html#env-files
    basePath: import.meta.env.VITE_ORY_SDK_URL,
    baseOptions: {
      withCredentials: true,
    },
  }),
)
```

### Create main.tsx

This file is used as the main canvas for React. We will use this file to create our routes and render our components.

```tsx
import React from "react"
import ReactDOM from "react-dom/client"
import { BrowserRouter } from "react-router-dom"
import { ThemeProvider } from "@ory/elements"
import App from "./App"
import "./index.css"

// import our Ory elements css
import "@ory/elements/style.css"

ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
  <React.StrictMode>
    <BrowserRouter>
      {/* We add the Ory themes here */}
      <ThemeProvider>
        <App />
      </ThemeProvider>
    </BrowserRouter>
  </React.StrictMode>,
)
```

If you are implementing Ory Elements in an existing project, you can just add the Ory Elements theme and imports instead as shown:

```tsx
//...imports
import ReactDOM from "react-dom/client"
import { BrowserRouter } from "react-router-dom"
import { ThemeProvider } from "@ory/elements"
//...

//...existing main.tsx
// Router from React Router
;<BrowserRouter>
  {/* We add the Ory themes here */}
  <ThemeProvider>
    <App />
  </ThemeProvider>
</BrowserRouter>
//...
```

### App.tsx Imports

```tsx
import reactLogo from "./assets/react.svg"
import React, { useEffect, useState } from "react"
import "./App.css"
import { Routes, Route, useNavigate } from "react-router-dom"
import { Session } from "@ory/client"
import { Typography } from "@ory/elements"
import sdk from "./sdk"
```

### App.tsx

Create our main Dashboard / Home Page.

```tsx
const Dashboard = () => {
  const [session, setSession] = useState<Session | null>(null)
  const [logoutUrl, setLogoutUrl] = useState<string>()

  const navigate = useNavigate()

  useEffect(() => {
    sdk
      .toSession()
      .then(({ data: session }) => {
        setSession(session)
      })
      .catch((error) => {
        if (error.response?.status === 403) {
          if (error.response?.data.error.id === "session_aal2_required") {
            return navigate("/login?aal2=true", { replace: true })
          }
        }
        return navigate("/login", { replace: true })
      })
  }, [])

  useEffect(() => {
    sdk
      .createSelfServiceLogoutFlowUrlForBrowsers(undefined, {
        params: {
          return_url: "/",
        },
      })
      .then(({ data }) => {
        setLogoutUrl(data.logout_url)
      })
      .catch((data) => {
        console.error(data)
      })
  }, [])

  // Return our basic dashboard using Ory Elements themes
  return (
    <>
      <Typography size={"headline37"}>Welcome to the dashboard!</Typography>
      <Typography size={"headline21"}>
        {session?.identity.traits.firstName} you can logout here: <a href={logoutUrl}>Logout</a> or go to your settings page here:{" "}
        <a href="/settings">Settings</a>
      </Typography>
      <pre>
        <code>{JSON.stringify(session, null, 2)}</code>
      </pre>
    </>
  )
}
```

## Basic Registration / Login

### Create Registration.tsx

```tsx
import React from "react"
import { SelfServiceRegistrationFlow, SubmitSelfServiceRegistrationFlowBody } from "@ory/client"
import { useEffect, useState } from "react"
import { UserAuthCard } from "@ory/elements"
import sdk from "./sdk"
import { useNavigate } from "react-router-dom"

export const Registration = () => {
  const [flow, setFlow] = useState<SelfServiceRegistrationFlow | null>(null)

  const navigate = useNavigate()

  useEffect(() => {
    sdk
      .initializeSelfServiceRegistrationFlowForBrowsers()
      .then(({ data: flow }) => {
        setFlow(flow)
      })
      .catch((error) => console.error(error))
  }, [])

  const onSubmit = (body: SubmitSelfServiceRegistrationFlowBody) => {
    if (!flow) {
      return
    }
    sdk
      .submitSelfServiceRegistrationFlow(flow.id, body as SubmitSelfServiceRegistrationFlowBody)
      .then(() => {
        // we successfully submitted the registration flow, so lets redirect to the dashboard
        navigate("/", { replace: true })
      })
      .catch((error) => {
        setFlow(error.response.data)
      })
  }

  // Return our dashboard using Ory Elements themes
  return flow ? (
    <UserAuthCard
      flow={flow}
      flowType={"registration"}
      title={"Registration"}
      additionalProps={{
        loginURL: "/login",
      }}
      includeScripts={true}
      onSubmit={({ body }) => onSubmit(body as SubmitSelfServiceRegistrationFlowBody)}
    />
  ) : (
    <div>Loading...</div>
  )
}
```

### Create Login.tsx

```tsx
import React, { useCallback, useEffect, useState } from "react"
import { SelfServiceLoginFlow, SubmitSelfServiceLoginFlowBody } from "@ory/client"
import { UserAuthCard } from "@ory/elements"
import sdk from "./sdk"
import { useNavigate, useSearchParams } from "react-router-dom"

export const Login = (): JSX.Element => {
  const [flow, setFlow] = useState<SelfServiceLoginFlow | null>(null)
  const [searchParams, setSearchParams] = useSearchParams()

  const navigate = useNavigate()

  const handleFlow = useCallback(({ refresh, mfa }: { refresh: boolean; mfa: boolean }) => {
    return sdk.initializeSelfServiceLoginFlowForBrowsers(refresh, mfa ? "aal2" : "aal1").then(({ data: flow }) => flow)
  }, [])

  useEffect(() => {
    const aal2 = searchParams.get("aal2")
    const isMFA = aal2 ? true : false
    handleFlow({ refresh: true, mfa: isMFA })
      .then((flow) => setFlow(flow))
      .catch((error) => {
        switch (error.response?.status) {
          case 400:
            setFlow(error.response.data)
            break
          case 410:
          case 404:
            return navigate("/login", { replace: true })
        }
      })
  }, [])

  const onSubmit = (body: SubmitSelfServiceLoginFlowBody) => {
    if (!flow) {
      return
    }
    sdk
      .submitSelfServiceLoginFlow(flow.id, body as SubmitSelfServiceLoginFlowBody)
      .then(() => {
        // we successfully submitted the login flow, so lets redirect to the dashboard
        navigate("/", { replace: true })
      })
      .catch((error) => {
        switch (error.response.status) {
          case 400:
            setFlow(error.response.data)
            break
          case 410:
          case 404:
            return navigate("/login", { replace: true })
        }
      })
  }

  // Return our dashboard using Ory Elements themes
  return flow ? (
    <UserAuthCard
      flow={flow}
      flowType={"login"}
      additionalProps={{
        forgotPasswordURL: "/recovery",
        signupURL: "/signup",
      }}
      title={"Login"}
      includeScripts={true}
      onSubmit={({ body }) => onSubmit(body as SubmitSelfServiceLoginFlowBody)}
    />
  ) : (
    <div>Loading...</div>
  )
}
```

### Run your app

```bash
npm run dev -- --port 3000
```

### Run Ory CLI Tunnel

```bash
ory tunnel http://localhost:3000 --project <project-slug> --dev
```

To access your React app, open [http://localhost:3000](http://localhost:3000) in your browser. You should see the login page!
